<!DOCTYPE html>
<html lang="sl">
<head>
  <meta charset="UTF-8">
  <title>Račun {{invoiceNumber}}</title>
  <style>
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }

    body {
      font-family: 'Arial', 'Helvetica', sans-serif;
      font-size: 10pt;
      color: #333;
      padding: 20px 40px;
      background: #fff;
    }

    /* Brand Colors */
    .brand-blue { color: #007289; }
    .brand-orange { color: #D2804D; }
    .bg-brand-blue { background-color: #007289; }
    .bg-brand-orange { background-color: #D2804D; }

    /* Header Section */
    .header {
      display: grid;
      grid-template-columns: 1fr 1fr 1fr;
      gap: 20px;
      margin-bottom: 20px;
      padding-bottom: 15px;
      border-bottom: 2px solid #007289;
      align-items: start;
    }

    .header-left {
      display: flex;
      align-items: flex-start;
      justify-content: flex-start;
    }

    .logo {
      max-width: 100%;
      max-height: 100px;
      width: auto;
      height: auto;
    }

    .header-middle {
      font-size: 7pt;
      line-height: 1.5;
      color: #333;
      text-align: left;
      margin-left: auto;
      width: fit-content;
    }

    .header-right {
      text-align: right;
      font-size: 7pt;
      line-height: 1.5;
      color: #333;
    }

    /* Customer and Invoice Info Section */
    .info-section {
      display: flex;
      justify-content: space-between;
      margin-bottom: 30px;
    }

    .customer-info {
      flex: 1;
      padding: 12px;
      background: #f8f9fa;
      border: 1px solid #e2e8f0;
      border-radius: 4px;
      line-height: 1.3;
    }

    .invoice-info {
      flex: 1;
      margin-left: 30px;
      text-align: right;
      line-height: 1.3;
    }

    .invoice-number {
      font-size: 13pt;
      font-weight: bold;
      color: #007289;
      margin-bottom: 12px;
      letter-spacing: 0.5px;
    }

    .info-label {
      font-weight: bold;
      color: #666;
      font-size: 7pt;
    }

    .info-value {
      margin-bottom: 6px;
      font-size: 7.5pt;
    }

    /* Pricing Table */
    table {
      width: 100%;
      border-collapse: collapse;
      margin-bottom: 20px;
    }

    thead {
      background-color: #007289;
      color: white;
    }

    thead th {
      padding: 6px 8px;
      text-align: left;
      font-size: 7pt;
      font-weight: bold;
      border: 1px solid #005666;
    }

    thead th.right {
      text-align: right;
    }

    thead th.center {
      text-align: center;
    }

    tbody td {
      padding: 4px 8px;
      border: 1px solid #ddd;
      font-size: 7.5pt;
    }

    tbody td.right {
      text-align: right;
    }

    tbody td.center {
      text-align: center;
    }

    tbody tr:nth-child(even) {
      background-color: #f8f9fa;
    }

    /* Totals Section */
    .totals-section {
      display: flex;
      justify-content: flex-end;
      margin-top: 20px;
    }

    .totals-table {
      width: 350px;
    }

    .totals-table td {
      padding: 5px 8px;
      border: none;
      font-size: 7pt;
    }

    .totals-table td:first-child {
      text-align: right;
      font-weight: 600;
      color: #666;
    }

    .totals-table td:last-child {
      text-align: right;
      font-weight: bold;
    }

    .total-row {
      border-top: 2px solid #007289;
      background-color: #f0f7f9;
    }

    .total-row td {
      padding: 8px !important;
      font-size: 9pt !important;
      color: #007289 !important;
    }

    /* Footer Section */
    .footer {
      margin-top: 30px;
      padding-top: 15px;
      border-top: 1px solid #ddd;
      font-size: 8pt;
      color: #333;
      line-height: 1.5;
    }

    .signature-section {
      margin-top: 25px;
      text-align: center;
    }

    .signature-line {
      display: inline-block;
      width: 250px;
      border-bottom: 1px solid #333;
      margin-top: 40px;
      margin-bottom: 5px;
    }

    .signature-label {
      font-size: 9pt;
      color: #333;
    }

    /* Payment Info Section */
    .payment-info {
      background: #fff8f0;
      border: 1px solid #e2e8f0;
      padding: 10px;
      margin-bottom: 20px;
      border-radius: 4px;
    }

    .payment-title {
      font-size: 8pt;
      font-weight: 700;
      color: #D2804D;
      margin-bottom: 6px;
    }

    .payment-content {
      display: flex;
      gap: 12px;
      align-items: center;
    }

    .payment-grid {
      flex: 1;
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 5px;
      font-size: 7pt;
    }

    .payment-item {
      display: flex;
      gap: 8px;
    }

    .payment-label {
      font-weight: 700;
      color: #333;
    }

    .payment-value {
      color: #333;
      font-weight: 600;
      font-family: 'Courier New', monospace;
    }

    /* QR Code Section */
    .qr-code-section {
      display: flex;
      flex-direction: row;
      align-items: center;
      gap: 8px;
      background: white;
      padding: 8px;
      border-radius: 6px;
      border: 2px solid #D2804D;
    }

    .qr-code-image {
      width: 70px;
      height: 70px;
      display: block;
      flex-shrink: 0;
    }

    .qr-code-label {
      font-size: 6.5pt;
      color: #D2804D;
      font-weight: 600;
      text-align: left;
      line-height: 1.4;
    }

    /* Utilities */
    .bold { font-weight: bold; }
    .text-right { text-align: right; }
    .mt-20 { margin-top: 20px; }

    /* Pagination */
    @page {
      @bottom-right {
        content: counter(page) " / " counter(pages);
        font-size: 8pt;
        color: #666;
        font-family: 'Arial', sans-serif;
      }
    }

    .page-number {
      position: fixed;
      bottom: 10mm;
      right: 15mm;
      font-size: 8pt;
      color: #666;
    }
  </style>
</head>
<body>
  <!-- Header Section -->
  <div class="header">
    <!-- Left: Logo Only -->
    <div class="header-left">
      {{#if lab.logoPath}}
      <img src="{{lab.logoPath}}" alt="{{lab.laboratoryName}}" class="logo">
      {{/if}}
    </div>

    <!-- Middle: Contact Info -->
    <div class="header-middle">
      {{lab.street}}, {{lab.postalCode}} {{lab.city}}<br>
      E: {{lab.email}}<br>
      {{#if lab.website}}S: {{lab.website}}<br>{{/if}}
      T: {{lab.phone}}
    </div>

    <!-- Right: IBAN + Tax Info -->
    <div class="header-right">
      IBAN: {{lab.bankAccount}}<br>
      {{#if lab.bankSwift}}SIGE: {{lab.bankSwift}}<br>{{/if}}
      {{#if lab.taxId}}ID za DDV: {{lab.taxId}}{{/if}}
    </div>
  </div>

  <!-- Customer and Invoice Info -->
  <div class="info-section">
    <div class="customer-info">
      <div class="info-label">PLAČNIK:</div>
      <div class="info-value"><strong>{{dentist.clinicName}}</strong></div>
      {{#if dentist.dentistName}}<div class="info-value">{{dentist.dentistName}}</div>{{/if}}
      {{#if dentist.address}}<div class="info-value">{{dentist.address}}</div>{{/if}}
      {{#if dentist.city}}<div class="info-value">{{dentist.postalCode}} {{dentist.city}}</div>{{/if}}
      {{#if dentist.taxNumber}}
      <div class="info-value mt-20">
        <span class="info-label">Davčna številka:</span> {{dentist.taxNumber}}
      </div>
      {{/if}}
    </div>

    <div class="invoice-info">
      <div class="invoice-number">RAČUN {{invoiceNumber}}</div>
      <div class="info-value">
        <span class="info-label">Datum računa:</span> {{invoiceDate}}
      </div>
      <div class="info-value">
        <span class="info-label">Kraj:</span> {{lab.city}}
      </div>
      <div class="info-value">
        <span class="info-label">Datum zapadlosti:</span> {{dueDate}}
      </div>
      <div class="info-value">
        <span class="info-label">Referenca:</span> {{paymentReference}}
      </div>
      <div class="info-value">
        <span class="info-label">Datum opravljanja:</span> {{serviceDate}}
      </div>
    </div>
  </div>

  <!-- Pricing Table -->
  <table>
    <thead>
      <tr>
        <th style="width: 43%;">Opis</th>
        <th class="center" style="width: 10%;">Količina</th>
        <th class="right" style="width: 12%;">Cena/EM</th>
        <th class="center" style="width: 8%;">Pop. (%)</th>
        <th class="center" style="width: 8%;">DDV (%)</th>
        <th class="right" style="width: 15%;">Vrednost</th>
      </tr>
    </thead>
    <tbody>
      {{#each lineItems}}
      <tr>
        <td>
          {{description}}
          {{#if worksheetNumber}}<br><span style="font-size: 8pt; color: #666;">DN: {{worksheetNumber}}</span>{{/if}}
          {{#if notes}}<br><span style="font-size: 8pt; color: #666;">{{notes}}</span>{{/if}}
        </td>
        <td class="center">{{quantity}}</td>
        <td class="right">€{{unitPrice}}</td>
        <td class="center">{{#if ../discountRate}}{{../discountRate}}{{else}}0,00{{/if}}</td>
        <td class="center">{{#if ../taxRate}}{{../taxRate}}{{else}}22,00{{/if}}</td>
        <td class="right">€{{totalPrice}}</td>
      </tr>
      {{/each}}
    </tbody>
  </table>

  <!-- Totals Section -->
  <div class="totals-section">
    <table class="totals-table">
      <tr>
        <td>SKUPAJ:</td>
        <td>€{{subtotal}}</td>
      </tr>
      {{#if (gt discountAmount "0")}}
      <tr>
        <td>POPUST:</td>
        <td>€{{discountAmount}}</td>
      </tr>
      {{/if}}
      <tr>
        <td>VREDNOST brez DDV:</td>
        <td>€{{subtotal}}</td>
      </tr>
      <tr>
        <td>DDV {{taxRate}}% od osnove €{{subtotal}}:</td>
        <td>€{{taxAmount}}</td>
      </tr>
      <tr class="total-row">
        <td>SKUPAJ ZA PLAČILO:</td>
        <td>€{{totalAmount}}</td>
      </tr>
    </table>
  </div>

  <!-- Payment Information -->
  <div class="payment-info">
    <div class="payment-title">Podatki za plačilo / Payment Information</div>
    <div class="payment-content">
      <div class="payment-grid">
        {{#if lab.bankName}}
        <div class="payment-item">
          <span class="payment-label">Banka:</span>
          <span class="payment-value">{{lab.bankName}}</span>
        </div>
        {{/if}}
        {{#if lab.bankAccount}}
        <div class="payment-item">
          <span class="payment-label">IBAN:</span>
          <span class="payment-value">{{lab.bankAccount}}</span>
        </div>
        {{/if}}
        {{#if lab.bankSwift}}
        <div class="payment-item">
          <span class="payment-label">SWIFT/BIC:</span>
          <span class="payment-value">{{lab.bankSwift}}</span>
        </div>
        {{/if}}
        <div class="payment-item">
          <span class="payment-label">Referenca:</span>
          <span class="payment-value">{{paymentReference}}</span>
        </div>
        <div class="payment-item">
          <span class="payment-label">Znesek:</span>
          <span class="payment-value">€{{totalAmount}}</span>
        </div>
        <div class="payment-item">
          <span class="payment-label">Rok plačila:</span>
          <span class="payment-value">{{dueDate}}</span>
        </div>
      </div>

      {{#if paymentQRCode}}
      <div class="qr-code-section">
        <img src="{{paymentQRCode}}" alt="Payment QR Code" class="qr-code-image" />
        <div class="qr-code-label">
          Skenirajte za plačilo<br/>
          Scan to Pay
        </div>
      </div>
      {{/if}}
    </div>
  </div>

  <!-- Notes -->
  {{#if notes}}
  <div style="margin-bottom: 20px;">
    <div style="font-size: 11pt; font-weight: bold; color: #007289; margin-bottom: 8px;">Opombe / Notes</div>
    <div style="background: #f8f9fa; border: 1px solid #ddd; border-radius: 4px; padding: 12px; font-size: 9pt; color: #555;">
      {{notes}}
    </div>
  </div>
  {{/if}}

  <!-- Footer -->
  <div class="footer">
    <!-- Legal Terms and Signature (70/30 Layout) -->
    <div style="display: flex; gap: 20px; margin-bottom: 30px;">
      <!-- Left: Legal Terms (70%) -->
      <div style="flex: 0 0 68%; font-size: 7pt; line-height: 1.6; color: #333; text-align: justify;">
        {{#if lab.invoiceLegalTerms}}
          {{{lab.invoiceLegalTerms}}}
        {{else}}
          Znesek računa plačajte v navedenem roku sicer bomo zaračunali zakonske zamudne obresti.
          V skladu s prvim odstavkom 94.člena z DDV-1 opravljam dejavnost oproščeno obračunavanja DDV.
          Izjavljam in prevzemam vso odgovornost za skladnost izdelka(ov) z bistvenimi zahtevami Pravilnika o medicinskih pripomočkih
          (Ur. l. RS št. 71/03). Obveznosti za pogojnih zavez (UL) R.S. št 54/2021) ter Uredbe (UE) R.S. št 2017/745 o medicinskih pripomočkih.
        {{/if}}
      </div>

      <!-- Right: Issuer and Signature (30%) -->
      <div style="flex: 0 0 28%; text-align: center;">
        <div style="font-weight: 500; font-size: 9pt; margin-bottom: {{#if lab.signaturePath}}10px{{else}}40px{{/if}};">Račun izdal: {{issuedBy}}</div>
        {{#if lab.signaturePath}}
        <img src="{{lab.signaturePath}}" alt="Signature" style="max-width: 150px; max-height: 60px; margin-bottom: 5px;" />
        {{else}}
        <div style="border-bottom: 1px solid #333; margin-bottom: 5px; margin-top: 30px;"></div>
        <div style="font-size: 8pt; color: #666;">Podpis</div>
        {{/if}}
      </div>
    </div>
  </div>

  <!-- Bottom Footer -->
  <div style="margin-top: 20px; padding-top: 12px; border-top: 2px solid #007289; font-size: 7pt; text-align: center; color: #333;">
    <strong>Sedež podjetja:</strong> {{lab.laboratoryName}}, {{lab.street}}, {{lab.postalCode}} {{lab.city}}, {{lab.country}}<br>
    {{#if lab.registrationNumber}}<strong>Matična številka:</strong> {{lab.registrationNumber}} | {{/if}}
    {{#if lab.taxId}}<strong>ID za DDV:</strong> {{lab.taxId}}<br>{{/if}}
    <strong>Osnovni kapital:</strong> 7.500 EUR | <strong>Družba je vpisana pri Okrožnem sodišču Ljubljana.</strong>
  </div>
</body>
</html>
